"use strict";(self.webpackChunkcicd_lab=self.webpackChunkcicd_lab||[]).push([[2018],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var o=r.createContext({}),u=function(e){var t=r.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=u(e.components);return r.createElement(o.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,s=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(a),d=n,h=p["".concat(o,".").concat(d)]||p[d]||m[d]||s;return a?r.createElement(h,i(i({ref:t},c),{},{components:a})):r.createElement(h,i({ref:t},c))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=a.length,i=new Array(s);i[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[p]="string"==typeof e?e:n,i[1]=l;for(var u=2;u<s;u++)i[u]=a[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>i});var r=a(7294),n=a(6010);const s={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:a,className:i}=e;return r.createElement("div",{role:"tabpanel",className:(0,n.Z)(s.tabItem,i),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>y});var r=a(7462),n=a(7294),s=a(6010),i=a(2466),l=a(6550),o=a(1980),u=a(7392),c=a(12);function p(e){return function(e){return n.Children.map(e,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:a,attributes:r,default:n}}=e;return{value:t,label:a,attributes:r,default:n}}))}function m(e){const{values:t,children:a}=e;return(0,n.useMemo)((()=>{const e=t??p(a);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function d(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:a}=e;const r=(0,l.k6)(),s=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,o._X)(s),(0,n.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(r.location.search);t.set(s,e),r.replace({...r.location,search:t.toString()})}),[s,r])]}function k(e){const{defaultValue:t,queryString:a=!1,groupId:r}=e,s=m(e),[i,l]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=a.find((e=>e.default))??a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:s}))),[o,u]=h({queryString:a,groupId:r}),[p,k]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,s]=(0,c.Nk)(a);return[r,(0,n.useCallback)((e=>{a&&s.set(e)}),[a,s])]}({groupId:r}),g=(()=>{const e=o??p;return d({value:e,tabValues:s})?e:null})();(0,n.useLayoutEffect)((()=>{g&&l(g)}),[g]);return{selectedValue:i,selectValue:(0,n.useCallback)((e=>{if(!d({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),k(e)}),[u,k,s]),tabValues:s}}var g=a(2389);const N={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:t,block:a,selectedValue:l,selectValue:o,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),m=e=>{const t=e.currentTarget,a=c.indexOf(t),r=u[a].value;r!==l&&(p(t),o(r))},d=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const a=c.indexOf(e.currentTarget)+1;t=c[a]??c[0];break}case"ArrowLeft":{const a=c.indexOf(e.currentTarget)-1;t=c[a]??c[c.length-1];break}}t?.focus()};return n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":a},t)},u.map((e=>{let{value:t,label:a,attributes:i}=e;return n.createElement("li",(0,r.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:d,onClick:m},i,{className:(0,s.Z)("tabs__item",N.tabItem,i?.className,{"tabs__item--active":l===t})}),a??t)})))}function f(e){let{lazy:t,children:a,selectedValue:r}=e;if(a=Array.isArray(a)?a:[a],t){const e=a.find((e=>e.props.value===r));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return n.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function x(e){const t=k(e);return n.createElement("div",{className:(0,s.Z)("tabs-container",N.tabList)},n.createElement(b,(0,r.Z)({},e,t)),n.createElement(f,(0,r.Z)({},e,t)))}function y(e){const t=(0,g.Z)();return n.createElement(x,(0,r.Z)({key:String(t)},e))}},914:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>l,toc:()=>u});var r=a(7462),n=(a(7294),a(3905));a(4866),a(5162);const s={title:"Register Nexus OSS with NKE cluster"},i="Register Nexus OSS with NKE cluster",l={unversionedId:"nexus_nke/nexus_nke",id:"nexus_nke/nexus_nke",title:"Register Nexus OSS with NKE cluster",description:"NKE had defined the following requirements for the image registry such as JFrog Artifactory or Nexus OSS.",source:"@site/docs/nexus_nke/nexus_nke.mdx",sourceDirName:"nexus_nke",slug:"/nexus_nke/",permalink:"/cicd_lab/nexus_nke/",draft:!1,editUrl:"https://github.com/mat0606/cicd_lab/edit/main/docs/nexus_nke/nexus_nke.mdx",tags:[],version:"current",frontMatter:{title:"Register Nexus OSS with NKE cluster"},sidebar:"tutorialSidebar",previous:{title:"Create Namespace in NKE cluster",permalink:"/cicd_lab/nexus_nke/create_ns"},next:{title:"Configure Worker Node in NKE cluster",permalink:"/cicd_lab/nexus_nke/worker_node"}},o={},u=[],c={toc:u},p="wrapper";function m(e){let{components:t,...s}=e;return(0,n.kt)(p,(0,r.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"register-nexus-oss-with-nke-cluster"},"Register Nexus OSS with NKE cluster"),(0,n.kt)("p",null,"NKE had defined the following requirements for the image registry such as JFrog Artifactory or Nexus OSS."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"The image registry must be configured to use HTTPS."),(0,n.kt)("li",{parentName:"ol"},"The certificate generation for the private image registry must contains Subject Alternate Name")),(0,n.kt)("p",null,"The Nexus OSS HTTPS blueprint would provision a Nexus OSS Repository which meet these requirements"),(0,n.kt)("h1",{id:"retrieve-the-vm-name-for-nexus-image-registry"},"Retrieve the VM name for Nexus Image Registry"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Click on Application icon.  Filter by Nexus.  Drill into your assigned image registry"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(8612).Z,width:"903",height:"450"}))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Click on ",(0,n.kt)("strong",{parentName:"p"},"Services"),".  Click on ",(0,n.kt)("strong",{parentName:"p"},"Nexus")),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(3917).Z,width:"834",height:"363"}))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"On the right side of the screen, note down the VM name for Nexus server."),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(51).Z,width:"453",height:"523"})))),(0,n.kt)("h1",{id:"create-secret-to-register-docker-server-and-credential"},"Create Secret to register Docker server and credential"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the window to the putty tab for Centos VM in the \u201cCreate K8S cluster\u201d Calm application.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change this command according to your assigned Nexus VM and Kubernetes namespace"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"a.  docker-server\nb.  namespace\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"This is an example of the command"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create secret docker-registry regcred --docker-server=https://n230305-013447.ntnxlab.local:18090 --docker-username=mat0606 --docker-password=xxxxx --docker-email=mat0606@hotmail.com -n devops18\n")))),(0,n.kt)("h1",{id:"setup-nexus-name-resolution-in-prism-central"},"Setup Nexus Name Resolution in Prism Central"),(0,n.kt)("p",null,"NKE needs to trust the Nexus OSS certificate"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Putty into Prism Central using the credential provided by the trainer.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the highlighted according to your environment."),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"10.38.218.93 n230305-013447.ntnxlab.local n230305-013447")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'sudo vi /etc/hosts\n"10.38.218.93 n230305-013447.ntnxlab.local n230305-013447" \n\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"This is a picture for this command"),(0,n.kt)("p",{parentName:"li"}," ",(0,n.kt)("img",{src:a(5783).Z,width:"903",height:"70"}))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Repeat for Prism Central Scale Out.  Request the 3 Prism Central IP address from the trainer."))),(0,n.kt)("h1",{id:"transfer-nexus-oss-certificate-into-prism-central"},"Transfer Nexus OSS certificate into Prism Central"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Putty into Prism Central")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the highlighted item.  Run this command to transfer the nexus_server.pem in Nexus OSS VM into Prism Central tmp directory."),(0,n.kt)("p",{parentName:"li"},"REGISTRY_IP=",(0,n.kt)("strong",{parentName:"p"},"n230305-013447.ntnxlab.local")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"REGISTRY_IP=n230305-013447.ntnxlab.local\nscp -oStrictHostKeyChecking=no centos@${REGISTRY_IP}:~/nexus_server.pem /tmp\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Key in the password as advised by the trainer"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(2396).Z,width:"903",height:"107"}))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Run this command"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mv /tmp/nexus_server.pem /etc/ssl/certs\ncd /etc/ssl/certs\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the highlighted based on which cluster the Nexus is deployed.  Check with the trainer"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mv nexus_server.pem nexus_server_218.crt\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Repeat for Prism Central Scale Out.  "))),(0,n.kt)("h1",{id:"register-nexus-oss-private-image-registry-with-nke"},"Register Nexus OSS Private Image Registry with NKE"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Putty into the Prism Central.  Login to Karbonctl using Prism Central UI password")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Navigate to this directory"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"cd /home/nutanix/karbon\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Retrieve the prism central web password from the trainer.  Run this command."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./karbonctl login --pc-username admin --pc-password xxxxxx\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the highlighted item"),(0,n.kt)("p",{parentName:"li"},"curl -k -v -X GET -u ",(0,n.kt)("strong",{parentName:"p"},"nexus user id"),":",(0,n.kt)("strong",{parentName:"p"},"nexus password")," ",(0,n.kt)("strong",{parentName:"p"},(0,n.kt)("a",{parentName:"strong",href:"https://n230305-013447.ntnxlab.local:18090/v2/"},"https://n230305-013447.ntnxlab.local:18090/v2/"))," --cacert /etc/ssl/certs/nexus_server",(0,n.kt)("strong",{parentName:"p"},"_218"),".crt")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"An example is "),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"curl -k -v -X GET -u <nexus user id>:<nexus password> https://n230305-013447.ntnxlab.local:18090/v2/ --cacert /etc/ssl/certs/nexus_server_218.crt\n")))),(0,n.kt)("ol",{start:6},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Run this command to test the connection to the Nexus OSS."),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(4824).Z,width:"903",height:"679"}))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Register the Nexus OSS private registry with Karbon Private Image Registry.  Change the highlighted item."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./karbonctl registry add --name **n230305-013447** --url **n230305-013447**.ntnxlab.local --port **18090** --cert-file **/etc/ssl/certs/nexus_server_218.crt** --username **nexus username** --password **nexus password**\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"This is an example for the command"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./karbonctl registry add --name n230305-013447 --url n230305-013447.ntnxlab.local --port 18090 --cert-file /etc/ssl/certs/nexus_server_218.crt --username nexus username --password nexus password\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The output is"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(2835).Z,width:"903",height:"67"}))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Verify the output"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(9754).Z,width:"903",height:"123"}))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the highlighted items as assigned by your trainer.  The Nexus OSS registry name is based on what you have provisioned earlier.  Register the Nexus OSS private registry with NKE Kubernetes Cluster"),(0,n.kt)("p",{parentName:"li"},"./karbonctl cluster registry add --cluster-name ",(0,n.kt)("strong",{parentName:"p"},"nke218_1")," --registry-name ",(0,n.kt)("strong",{parentName:"p"},"n230305-013447"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"An example is"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./karbonctl cluster registry add --cluster-name nke218_1 --registry-name n230305-013447\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the highlighted item.  Run the command to verify the registry"),(0,n.kt)("p",{parentName:"li"},"./karbonctl cluster registry list --cluster-name ",(0,n.kt)("strong",{parentName:"p"},"nke218_1"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"An example is "),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./karbonctl cluster registry list --cluster-name nke218_1\n\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"This is an example of the output"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:a(2427).Z,width:"903",height:"96"})))))}m.isMDXComponent=!0},8612:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/nexus_nke1-6b18bea49e16ee5b06b5173622980721.png"},3917:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/nexus_nke2-19f87c0042d355fa91055777e1555748.png"},51:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/nexus_nke3-ef7a983ef82fe60bda03aa5f7a8b2279.png"},5783:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/nexus_nke4-7adbe333b31e666f7f7245bcb05b7afd.png"},2396:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/nexus_nke5-892e0cfa01a0e3d36fcc7e22f6948e7f.png"},4824:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/nexus_nke6-93feadb2aba1231f6450c576b2b49a7b.png"},2835:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/nexus_nke7-7f97846424b66b04a572010e07117f55.png"},9754:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/nexus_nke8-4fab89b946276e63686e828e278cf1ed.png"},2427:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/nexus_nke9-a83628c3954832b2965e09152286ab35.png"}}]);